<!-- contact.html â€“ åªéœ€èˆ‡ contact.js æ”¾åœ¨åŒè³‡æ–™å¤¾ -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>é€²åº¦æŸ¥è©¢ç³»çµ±</title>

<!-- ================= ç¾ä»£åŒ– CSS ================= -->
<style>
/* -------- è‰²ç¥¨ -------- */
:root{
  --bg:#f1f4f9; --surface:#ffffff; --text:#263238; --sub:#607d8b;
  --primary:#3949ab; --primary-light:#5563c1; --accent:#ff5252;
  --green:#2e7d32; --red:#d32f2f; --orange:#ff9800;
}
body.dark{
  --bg:#1a1c23; --surface:#242731; --text:#e0e4ec; --sub:#9aa1b5;
  --primary:#7c9bff; --primary-light:#9db2ff; --accent:#ff7979;
}

*{box-sizing:border-box;}
body{
  margin:0;font-family:'Inter','Noto Sans TC',Helvetica,Arial,sans-serif;
  background:var(--bg);color:var(--text);transition:.3s;
}
button,input{font:inherit;font-size:1rem;}
a{color:inherit;text-decoration:none;}

/* -------- Header -------- */
header{
  position:sticky;top:0;z-index:10;
  display:flex;justify-content:space-between;align-items:center;
  padding:.9rem 1.6rem;background:var(--primary);color:#fff;
  box-shadow:0 2px 8px rgba(0,0,0,.15);
}
.controls{display:flex;gap:.65rem;align-items:center;}
.controls button{
  background:rgba(255,255,255,.15);color:#fff;border:none;
  padding:.42rem .9rem;border-radius:6px;cursor:pointer;
  transition:.2s;
}
.controls button:hover{background:rgba(255,255,255,.25);}
.hide{display:none !important;}          /* â† æœ€é«˜å„ªå…ˆæ¬Š */

/* -------- Layout -------- */
main{max-width:960px;margin:0 auto;padding:3rem 1rem;}
.card{
  background:var(--surface);border-radius:12px;padding:2rem 2.4rem;
  box-shadow:0 6px 28px rgba(0,0,0,.07);
}
.card h2{margin-top:0;font-size:1.45rem;}
.step{display:flex;align-items:flex-start;gap:.4rem;
      font-size:.92rem;color:var(--sub);margin:.35rem 0;}
.step span{font-weight:600;color:var(--primary-light);}

.input-group{display:flex;gap:.6rem;margin:1.2rem 0 1.6rem;}
.input-group input{
  flex:1;padding:.65rem 1rem;border:2px solid var(--primary-light);
  border-radius:8px;background:var(--surface);outline:none;
  transition:border-color .2s,box-shadow .2s;
}
.input-group input:focus{
  border-color:var(--primary);box-shadow:0 0 0 3px rgba(57,73,171,.18);
}
.primary-btn{
  background:var(--primary);color:#fff;border:none;
  padding:.65rem 1.2rem;border-radius:8px;cursor:pointer;
  transition:.2s;
}
.primary-btn:hover{background:var(--primary-light);transform:translateY(-1px);}

#errorMsg{color:var(--accent);font-weight:600;margin-top:.6rem;}

#filterBar{display:flex;gap:.6rem;margin:1.1rem 0;flex-wrap:wrap;}
#filterBar button{
  border:1px solid var(--primary-light);background:var(--surface);
  color:var(--text);padding:.45rem .9rem;border-radius:30px;
  cursor:pointer;font-size:.9rem;transition:.2s;
}
#filterBar button.active,
#filterBar button:hover{background:var(--primary);color:#fff;border-color:var(--primary);}

table{
  width:100%;border-collapse:collapse;background:var(--surface);
  box-shadow:0 4px 20px rgba(0,0,0,.06);border-radius:12px;overflow:hidden;
}
th,td{padding:.85rem 1rem;border-bottom:1px solid var(--bg);}
thead{background:rgba(57,73,171,.12);}
tbody tr:hover{background:rgba(0,0,0,.04);}
.status-replied{color:var(--green);font-weight:600;}
.status-waiting{color:var(--red);font-weight:600;}
.note-priority{color:var(--orange);font-weight:600;}

/* -------- è¡Œå‹•ç‰ˆ (â‰¤640px) -------- */
@media(max-width:640px){
  main{padding:2rem .6rem;}
  .card{padding:1.6rem 1.4rem;}
  table,tbody,tr,td{display:block;width:100%;}
  th{display:none;}
  tr{margin-bottom:1rem;border:1px solid var(--bg);border-radius:10px;
     background:var(--surface);box-shadow:0 2px 8px rgba(0,0,0,.05);}
  td{position:relative;padding:.85rem 1rem .85rem 48%;border:none;
      border-bottom:1px solid rgba(0,0,0,.07);}
  td:last-child{border-bottom:none;}
  td::before{
    content:attr(data-label);position:absolute;left:1rem;top:.85rem;
    font-weight:600;color:var(--sub);font-size:.88rem;
  }
}
</style>
</head>

<body>
  <!-- -------- Header -------- -->
  <header>
    <h1 style="font-size:1.25rem;">ğŸ“¬ é€²åº¦æŸ¥è©¢</h1>
    <div class="controls">
      <button id="darkToggle" title="æ·±å¤œæ¨¡å¼">ğŸŒ“</button>
      <button id="logoutBtn" class="hide">ç™»å‡º</button>
      <div id="google_translate_element"></div>
    </div>
  </header>

  <main>
    <!-- -------- ç™»å…¥å¡ç‰‡ -------- -->
    <section id="loginSection" class="card">
      <h2>å¿«é€ŸæŸ¥è©¢ä½ çš„ç§è¨Šç‹€æ…‹</h2>
      <div class="step"><span>â‘ </span>è¼¸å…¥ã€Œç§è¨Šç·¨è™Ÿã€æˆ–ç®¡ç†å“¡ä»£ç¢¼</div>
      <div class="step"><span>â‘¡</span>æŒ‰ä¸‹æŸ¥è©¢å³å¯å–å¾—é€²åº¦</div>

      <div class="input-group">
        <input type="text" id="pmId" placeholder="ä¾‹å¦‚ï¼š1234567890" autocomplete="off">
        <button id="submitBtn" class="primary-btn">æŸ¥è©¢</button>
      </div>
      <p style="font-size:.85rem;color:var(--sub);margin-top:-.7rem;">

      </p>
      <p id="errorMsg" class="hide"></p>
    </section>

    <!-- -------- çµæœå€ -------- -->
    <section id="resultSection" class="hide">
      <h2 id="resultTitle" style="margin-bottom:.6rem;"></h2>

      <div id="filterBar" class="hide">
        <button data-filter="all" class="active">å…¨éƒ¨</button>
        <button data-filter="replied">å·²å›è¦†</button>
        <button data-filter="waiting">å°šæœªå›è¦†</button>
      </div>

      <table id="msgTable">
        <thead>
          <tr>
            <th>æ™‚é–“</th><th>ä½¿ç”¨è€…å¸³è™Ÿ</th><th>ç§è¨Šç·¨è™Ÿ</th>
            <th>å›è¦†é€²åº¦</th><th>å‚™è¨»</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <!-- ================= è³‡æ–™æª” ================= -->
  <script src="contact.js"></script>

  <!-- ================= ä¸»é‚è¼¯ ================= -->
  <script>
  document.addEventListener('DOMContentLoaded',()=>{
    /* ========= å¿«é€Ÿé¸æ“‡ ========= */
    const $  = q=>document.querySelector(q);
    const $$ = q=>document.querySelectorAll(q);

    /* ========= DOM å…ƒä»¶ ========= */
    const pmInput   = $('#pmId');
    const loginCard = $('#loginSection');
    const resultSec = $('#resultSection');
    const filterBar = $('#filterBar');
    const tbody     = $('#msgTable tbody');
    const errorMsg  = $('#errorMsg');
    const logoutBtn = $('#logoutBtn');

    let currentRows = [];
    let loggedIn    = false;

    /* -------- åˆå§‹åŒ–ï¼šåªé¡¯ç¤ºç™»å…¥å¡ç‰‡ -------- */
    toggleAuthUI();

    /* -------- æ·±å¤œæ¨¡å¼ -------- */
    $('#darkToggle').onclick = () => document.body.classList.toggle('dark');

    /* -------- æŸ¥è©¢ -------- */
    $('#submitBtn').onclick = ()=>{
      const id = pmInput.value.trim();
      errorMsg.classList.add('hide');

      if(id.length < 4 || id.length > 20){
        return showErr('è«‹è¼¸å…¥ 4â€“20 ä½æ•¸å­—çš„ç§è¨Šç·¨è™Ÿ');
      }

      /* ç®¡ç†å“¡ */
      if(id === '99887765'){
        currentRows = [...messages].sort(byTimeDesc);
        $('#resultTitle').textContent = 'æ‰€æœ‰è¨Šæ¯ï¼ˆç®¡ç†å“¡ï¼‰';
        loggedIn = true;
        toggleAuthUI();
        renderTable(currentRows);
        return;
      }

      /* ä¸€èˆ¬ä½¿ç”¨è€… */
      const rows = messages.filter(m=>m.pmId === id).sort(byTimeDesc);
      if(rows.length === 0){
        return showErr('æŸ¥ç„¡è³‡æ–™ï¼Œè«‹ç¢ºèªç·¨è™Ÿæˆ–ç¨å¾Œå†è©¦(å°šæœªå…¥æª”)');
      }
      currentRows = rows;
      $('#resultTitle').textContent = `ç§è¨Šç·¨è™Ÿ ${id} çš„æŸ¥è©¢çµæœ`;
      loggedIn = true;
      toggleAuthUI();
      renderTable(currentRows);
    };

    /* -------- ç¯©é¸ -------- */
    filterBar.addEventListener('click',e=>{
      if(e.target.tagName !== 'BUTTON') return;
      $$('#filterBar button').forEach(b=>b.classList.remove('active'));
      e.target.classList.add('active');

      const f = e.target.dataset.filter;
      let rows = currentRows;
      if(f==='replied') rows = rows.filter(r=>r.status==='å·²å›è¦†');
      if(f==='waiting') rows = rows.filter(r=>r.status!=='å·²å›è¦†');
      renderTable(rows);
    });

    /* -------- ç™»å‡º -------- */
    logoutBtn.onclick = ()=>{
      loggedIn = false;
      pmInput.value = '';
      currentRows = [];
      toggleAuthUI();
    };

    /* -------- å…±ç”¨å‡½å¼ -------- */
    const byTimeDesc = (a,b)=>new Date(b.time)-new Date(a.time);
    const waitingCnt = cur =>
      messages.filter(m=>m.status!=='å·²å›è¦†' && new Date(m.time)<new Date(cur.time)).length;

    function renderTable(rows){
      tbody.innerHTML = '';
      rows.forEach(r=>{
        const prog = r.status==='å·²å›è¦†'
          ? 'å·²å›è¦†'
          : `å°šé ˆç­‰å€™ ${waitingCnt(r)} çµ„`;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td data-label="æ™‚é–“">${r.time.replace('T',' ').slice(0,19)}</td>
          <td data-label="ä½¿ç”¨è€…å¸³è™Ÿ">${r.account}</td>
          <td data-label="ç§è¨Šç·¨è™Ÿ">${r.pmId}</td>
          <td data-label="å›è¦†é€²åº¦"
              class="${r.status==='å·²å›è¦†'?'status-replied':'status-waiting'}">
              ${prog}
          </td>
          <td data-label="å‚™è¨»"
              class="${r.note==='å„ªå…ˆè¨Šæ¯'?'note-priority':''}">
              ${r.note}
          </td>`;
        tbody.appendChild(tr);
      });
    }

    function showErr(msg){
      errorMsg.innerHTML = msg;
      errorMsg.classList.remove('hide');
    }

    /* -------- å€å¡Šé¡¯ç¤ºæ§åˆ¶ -------- */
    function toggleAuthUI(){
      loginCard.classList.toggle('hide',  loggedIn);
      resultSec.classList.toggle('hide', !loggedIn);
      filterBar.classList.toggle('hide', !loggedIn);
      logoutBtn.classList.toggle('hide', !loggedIn);
    }
  });
  </script>

  <!-- ================= Google ç¿»è­¯ï¼š12 èªè¨€ ================= -->
  <script>
  function googleTranslateElementInit(){
    new google.translate.TranslateElement({
      pageLanguage:'zh-TW',
      includedLanguages:'zh-TW,zh-CN,en,ja,ko,fr,de,es,th,vi,id,pt',
      layout:google.translate.TranslateElement.InlineLayout.HORIZONTAL
    },'google_translate_element');
  }
  </script>
  <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
